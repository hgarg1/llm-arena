<%- include('../partials/header_layout') %>
    <div class="min-h-[calc(100vh-60px)] flex flex-col justify-center py-12 sm:px-6 lg:px-8 bg-background">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <h2 class="mt-6 text-center text-3xl font-bold tracking-tight text-primary">
                Two-Factor Authentication
            </h2>
            <p class="mt-2 text-center text-sm text-secondary">
                Enhance your account security
            </p>
        </div>

        <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-surface py-8 px-4 shadow sm:rounded-lg sm:px-10 border border-border">
                
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="mb-6 rounded-md bg-red-50 p-4 border border-red-200 text-sm text-red-700 font-medium">
                        <%= error %>
                    </div>
                <% } %>

                <% if (step === 1) { %>
                    <!-- Step 1: Scan QR -->
                    <div class="text-center">
                        <div class="mb-6">
                            <p class="text-sm text-secondary mb-4">Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.).</p>
                            <div class="bg-white p-2 inline-block rounded-lg border border-gray-200">
                                <img src="<%= qrCode %>" alt="QR Code" class="w-48 h-48">
                            </div>
                            <p class="text-xs text-gray-400 mt-2 font-mono select-all cursor-pointer hover:text-gray-600" title="Click to copy secret">
                                Secret: <%= secret %>
                            </p>
                        </div>

                        <form action="/account/mfa/verify" method="POST">
                            <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                            <div class="mb-6">
                                <label for="token" class="input-label mb-2">Enter 6-digit Code</label>
                                <input type="text" name="token" id="token" 
                                       class="input-field text-center text-2xl tracking-[0.5em] font-mono h-12" 
                                       maxlength="6" pattern="[0-9]*" inputmode="numeric" required autofocus
                                       placeholder="000000">
                            </div>
                            <button class="btn btn-primary w-full py-2.5">Verify & Activate</button>
                        </form>
                    </div>
                <% } else { %>
                    <!-- Step 2: Success / Backup Codes -->
                    <div class="text-center">
                        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
                            <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium leading-6 text-gray-900 mb-2">2FA Enabled Successfully</h3>
                        <p class="text-sm text-secondary mb-6">
                            Please save these backup codes in a secure place. You can use them to access your account if you lose your device.
                        </p>

                        <div class="bg-slate-50 border border-slate-200 rounded-md p-4 mb-6 grid grid-cols-2 gap-2 font-mono text-xs text-slate-700 select-all">
                            <% backupCodes.forEach(code => { %>
                                <div class="text-center bg-white py-1 rounded border border-slate-100"><%= code %></div>
                            <% }) %>
                        </div>

                        <div class="flex gap-3">
                            <button onclick="window.print()" class="btn btn-secondary flex-1">Print</button>
                            <a href="/account" class="btn btn-primary flex-1">Done</a>
                        </div>
                    </div>
                <% } %>

            </div>
        </div>
    </div>
<%- include('../partials/footer_layout') %>
