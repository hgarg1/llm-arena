<%- include('../partials/header_layout') %>
    <div class="min-h-[calc(100vh-60px)] flex flex-col justify-center py-12 sm:px-6 lg:px-8 bg-background">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <h2 class="mt-6 text-center text-3xl font-bold tracking-tight text-primary">
                Reset Password
            </h2>
            <p class="mt-2 text-center text-sm text-secondary">
                Establish new credentials for your account
            </p>
        </div>

        <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-surface py-8 px-4 shadow sm:rounded-lg sm:px-10 border border-border">
                
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="mb-4 rounded-md bg-red-50 p-4 border border-red-200">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800"><%= error %></h3>
                            </div>
                        </div>
                    </div>
                <% } %>

                <form action="/auth/reset-password" method="POST" class="space-y-6" x-data="resetWizard()">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    <input type="hidden" name="token" value="<%= token %>">
                    
                    <div>
                        <label for="password" class="input-label">New Password</label>
                        <div class="mt-1 relative rounded-md shadow-sm">
                            <input :type="showPassword ? 'text' : 'password'" 
                                   id="password" 
                                   name="password" 
                                   x-model="password"
                                   class="input-field pr-10" 
                                   required>
                            <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer" @click="showPassword = !showPassword">
                                <span class="text-xs text-secondary font-mono select-none" x-text="showPassword ? 'HIDE' : 'SHOW'"></span>
                            </div>
                        </div>
                        
                        <!-- Password Strength Meter -->
                        <div class="mt-4 space-y-2 bg-slate-50 p-3 rounded border border-slate-200">
                            <div class="flex justify-between items-center mb-1">
                                <span class="text-xs font-semibold uppercase text-secondary">Complexity Requirement</span>
                                <span class="text-xs font-bold" :class="isStrong ? 'text-green-600' : 'text-slate-500'" x-text="isStrong ? 'MET' : 'UNMET'"></span>
                            </div>
                            
                            <div class="grid grid-cols-2 gap-2 text-[10px] text-secondary">
                                <div class="flex items-center gap-1">
                                    <div class="w-2 h-2 rounded-full" :class="password.length >= 12 ? 'bg-green-500' : 'bg-slate-300'"></div>
                                    <span>12+ Characters</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <div class="w-2 h-2 rounded-full" :class="/[A-Z]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                    <span>Uppercase</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <div class="w-2 h-2 rounded-full" :class="/[a-z]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                    <span>Lowercase</span>
                                </div>
                                <div class="flex items-center gap-1">
                                    <div class="w-2 h-2 rounded-full" :class="/[0-9]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                    <span>Number</span>
                                </div>
                                <div class="flex items-center gap-1 col-span-2">
                                    <div class="w-2 h-2 rounded-full" :class="/[^A-Za-z0-9]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                    <span>Special Character (!@#$...)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" @click.prevent="submitForm($event)" class="btn btn-primary w-full flex justify-center py-2.5">
                        Update Credentials
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function resetWizard() {
            return {
                password: '',
                showPassword: false,
                
                get isStrong() {
                    return this.password.length >= 12 &&
                           /[A-Z]/.test(this.password) &&
                           /[a-z]/.test(this.password) &&
                           /[0-9]/.test(this.password) &&
                           /[^A-Za-z0-9]/.test(this.password);
                },

                submitForm(e) {
                    if (!this.isStrong) {
                        alert('Password does not meet complexity requirements.');
                        return;
                    }
                    e.target.closest('form').submit();
                }
            }
        }
    </script>
<%- include('../partials/footer_layout') %>
