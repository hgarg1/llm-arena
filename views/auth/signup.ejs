<%- include('../partials/header_layout') %>
    <div class="min-h-[calc(100vh-60px)] flex flex-col justify-center py-12 sm:px-6 lg:px-8 bg-background">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <h2 class="mt-6 text-center text-3xl font-bold tracking-tight text-primary">
                Initialize Account
            </h2>
            <p class="mt-2 text-center text-sm text-secondary">
                Secure access for authorized personnel
            </p>
        </div>

        <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-surface py-8 px-4 shadow sm:rounded-lg sm:px-10 border border-border">
                
                <% if (typeof error !== 'undefined' && error) { %>
                    <div class="mb-4 rounded-md bg-red-50 p-4 border border-red-200">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800"><%= error %></h3>
                            </div>
                        </div>
                    </div>
                <% } %>

                <form action="/auth/signup" method="POST" class="space-y-6" x-data="signupWizard()">
                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                    
                    <!-- Progress Bar -->
                    <div class="relative pt-1 pb-6">
                        <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-slate-100 border border-slate-200">
                            <div :style="`width: ${step === 1 ? '50%' : '100%'}`" class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-accent transition-all duration-500 ease-out"></div>
                        </div>
                        <div class="flex justify-between text-xs font-medium text-secondary uppercase tracking-wider">
                            <span :class="{'text-primary': step >= 1}">Step 1: Credentials</span>
                            <span :class="{'text-primary': step >= 2}">Step 2: Profile</span>
                        </div>
                    </div>

                    <!-- Step 1: Credentials -->
                    <div x-show="step === 1" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0">
                        <div class="space-y-6">
                            <div>
                                <label for="email" class="input-label">Email Address</label>
                                <div class="mt-1">
                                    <input id="email" name="email" type="email" autocomplete="email" required 
                                        class="input-field" 
                                        placeholder="name@organization.com">
                                </div>
                            </div>

                            <div>
                                <label for="password" class="input-label">Password</label>
                                <div class="mt-1 relative rounded-md shadow-sm">
                                    <input :type="showPassword ? 'text' : 'password'" 
                                           id="password" 
                                           name="password" 
                                           x-model="password"
                                           class="input-field pr-10" 
                                           required>
                                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center cursor-pointer" @click="showPassword = !showPassword">
                                        <span class="text-xs text-secondary font-mono select-none" x-text="showPassword ? 'HIDE' : 'SHOW'"></span>
                                    </div>
                                </div>
                                
                                <!-- Password Strength Meter -->
                                <div class="mt-4 space-y-2 bg-slate-50 p-3 rounded border border-slate-200">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs font-semibold uppercase text-secondary">Complexity Requirement</span>
                                        <span class="text-xs font-bold" :class="isStrong ? 'text-green-600' : 'text-slate-500'" x-text="isStrong ? 'MET' : 'UNMET'"></span>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-2 text-[10px] text-secondary">
                                        <div class="flex items-center gap-1">
                                            <div class="w-2 h-2 rounded-full" :class="password.length >= 12 ? 'bg-green-500' : 'bg-slate-300'"></div>
                                            <span>12+ Characters</span>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <div class="w-2 h-2 rounded-full" :class="/[A-Z]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                            <span>Uppercase</span>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <div class="w-2 h-2 rounded-full" :class="/[a-z]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                            <span>Lowercase</span>
                                        </div>
                                        <div class="flex items-center gap-1">
                                            <div class="w-2 h-2 rounded-full" :class="/[0-9]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                            <span>Number</span>
                                        </div>
                                        <div class="flex items-center gap-1 col-span-2">
                                            <div class="w-2 h-2 rounded-full" :class="/[^A-Za-z0-9]/.test(password) ? 'bg-green-500' : 'bg-slate-300'"></div>
                                            <span>Special Character (!@#$...)</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button type="button" @click="nextStep()" class="btn btn-primary w-full flex justify-center py-2.5">
                                Continue
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Profile -->
                    <div x-show="step === 2" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 translate-y-2" x-transition:enter-end="opacity-100 translate-y-0" style="display: none;">
                        <div class="space-y-6">
                            <div>
                                <label for="name" class="input-label">Full Name</label>
                                <div class="mt-1">
                                    <input id="name" name="name" type="text" required class="input-field">
                                </div>
                            </div>

                            <div>
                                <label for="company" class="input-label">Organization / Agency</label>
                                <div class="mt-1">
                                    <input id="company" name="company" type="text" class="input-field">
                                </div>
                            </div>

                            <div>
                                <label for="job_title" class="input-label">Role / Title</label>
                                <div class="mt-1">
                                    <input id="job_title" name="job_title" type="text" class="input-field">
                                </div>
                            </div>

                            <div>
                                <label for="phone" class="input-label">Phone Number (Optional)</label>
                                <div class="mt-1">
                                    <input id="phone" name="phone" type="tel" class="input-field" placeholder="+1 (555) 000-0000">
                                </div>
                                <p class="text-xs text-secondary mt-1">Used for 2FA and notifications.</p>
                            </div>

                            <div class="flex gap-3">
                                <button type="button" @click="step = 1" class="btn btn-secondary flex-1 py-2.5">Back</button>
                                <button type="submit" class="btn btn-primary flex-1 py-2.5">Create Account</button>
                            </div>
                        </div>
                    </div>

                </form>

                <div class="mt-6">
                    <div class="relative">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-border"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="bg-surface px-2 text-secondary">
                                Already have access?
                            </span>
                        </div>
                    </div>

                    <div class="mt-6">
                        <a href="/auth/login" class="flex w-full justify-center rounded-md border border-border bg-white py-2 px-4 text-sm font-medium text-secondary shadow-sm hover:bg-gray-50">
                            Sign in to existing account
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function signupWizard() {
            return {
                step: 1,
                password: '',
                showPassword: false,
                
                get isStrong() {
                    return this.password.length >= 12 &&
                           /[A-Z]/.test(this.password) &&
                           /[a-z]/.test(this.password) &&
                           /[0-9]/.test(this.password) &&
                           /[^A-Za-z0-9]/.test(this.password);
                },

                nextStep() {
                    const email = document.getElementById('email');
                    if (!email.checkValidity()) {
                        email.reportValidity();
                        return;
                    }
                    
                    if (!this.isStrong) {
                        alert('Password does not meet complexity requirements.');
                        return;
                    }
                    this.step = 2;
                }
            }
        }
    </script>
<%- include('../partials/footer_layout') %>
