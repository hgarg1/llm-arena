<%- include('../../partials/admin_header') %>
    <div class="mb-8 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Queue Inspector</h1>
            <p class="mt-1 text-sm text-gray-500">BullMQ job status.</p>
        </div>
        <div>
            <form action="/admin/queue/clean" method="POST" onsubmit="return confirm('Clear all completed and failed jobs?');">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <button class="btn btn-sm btn-secondary">Clean Old Jobs</button>
            </form>
        </div>
    </div>

    <!-- Tabs -->
    <div class="border-b border-gray-200 mb-6">
        <nav class="-mb-px flex space-x-8">
            <a href="/admin/queue?type=active" class="<%= currentType === 'active' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' %> whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Active (<%= counts.active %>)
            </a>
            <a href="/admin/queue?type=waiting" class="<%= currentType === 'waiting' ? 'border-yellow-500 text-yellow-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' %> whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Waiting (<%= counts.waiting %>)
            </a>
            <a href="/admin/queue?type=failed" class="<%= currentType === 'failed' ? 'border-red-500 text-red-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' %> whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Failed (<%= counts.failed %>)
            </a>
            <a href="/admin/queue?type=completed" class="<%= currentType === 'completed' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300' %> whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                Completed (<%= counts.completed %>)
            </a>
        </nav>
    </div>

    <div class="bg-white rounded-lg shadow border border-gray-200 overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Job ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Match ID</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Data</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Error / Result</th>
                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Actions</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                <% jobs.map(job => { %>
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-xs text-gray-500"><%= job.id %></td>
                        <td class="px-6 py-4 whitespace-nowrap font-mono text-xs text-blue-600">
                            <a href="/matches/<%= job.data.matchId %>"><%= job.data.matchId.substring(0,8) %></a>
                        </td>
                        <td class="px-6 py-4 text-xs text-gray-500 font-mono max-w-xs truncate">
                            <%= JSON.stringify(job.data) %>
                        </td>
                        <td class="px-6 py-4 text-xs text-red-500 max-w-xs truncate">
                            <%= job.failedReason || JSON.stringify(job.returnvalue) || '-' %>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                            <% if (currentType === 'failed') { %>
                                <form action="/admin/queue/<%= job.id %>/retry" method="POST" class="inline">
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <button class="text-blue-600 hover:text-blue-900">Retry</button>
                                </form>
                            <% } %>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
        <% if (jobs.length === 0) { %>
            <div class="p-8 text-center text-gray-500 text-sm">No jobs found in this state.</div>
        <% } %>
    </div>
<%- include('../../partials/admin_footer') %>
